<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vote Confirmation — Receipt</title>
<style>
  :root{
    --green: #0b6a33;
    --muted: #476b5b;
    --glass: rgba(255,255,255,0.96);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Noto Sans Bengali","Noto Sans",Arial,sans-serif;
    background:#f3faf6;
    color:#07301f;
  }
  .wrap{
    max-width:820px;
    margin:36px auto;
    padding:20px;
  }
  .card{
    background:var(--glass);
    padding:26px;
    border-radius:12px;
    box-shadow:0 18px 60px rgba(6,60,30,0.08);
    border:1px solid rgba(6,60,30,0.04);
  }

  .header-row{display:flex;align-items:center;gap:16px}
  .ok-circle{
    width:76px;height:76px;border-radius:50%;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(180deg,#dff7e6,#bfeece);
    color:var(--green);
    font-size:40px;font-weight:900;
    box-shadow:0 10px 30px rgba(6,60,30,0.08);
    transform:scale(.96);
    animation:pop .28s ease forwards;
  }
  @keyframes pop{from{transform:scale(.5);opacity:0}to{transform:scale(1);opacity:1}}

  h1{margin:0;font-size:20px;color:var(--green)}
  .muted{color:var(--muted);margin-top:6px}

  .receipt{margin-top:18px;border-top:1px dashed #e6efe8;padding-top:14px}
  .field{display:flex;justify-content:space-between;padding:12px 6px;border-radius:8px}
  .field + .field{margin-top:6px}
  .label{color:#23603f;font-weight:800}
  .value{color:#1f463a;font-weight:700}

  .meta{
    display:flex;
    gap:12px;
    align-items:center;
    margin-top:12px;
    flex-wrap:wrap;
  }
  .small{
    font-size:13px;color:#577b69;
    background:#fff;padding:8px 10px;border-radius:8px;border:1px solid #e6efe8;
  }

  .btn-row{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:10px;border:none;font-weight:800;cursor:pointer}
  .btn.primary{background:var(--green);color:#fff}
  .btn.ghost{background:transparent;border:1px solid #cfe8d6;color:var(--green)}
  .btn.alt{background:#e9f7ee;color:var(--green);border:1px solid rgba(11,79,49,0.06)}
  .note{margin-top:14px;color:var(--muted);font-size:14px}

  /* print styles */
  @media print{
    body{background:#fff}
    .btn-row, header, .note{display:none}
    .card{box-shadow:none;border:none}
  }
</style>
</head>
<body>
  <main class="wrap">
    <div class="card" role="region" aria-labelledby="title">
      <div class="header-row">
        <div class="ok-circle" aria-hidden="true">✓</div>
        <div>
          <h1 id="title">ভোট গ্রহণ করা হয়েছে — রশিদ</h1>
          <div class="muted">ধন্যবাদ! আপনার ভোট সফলভাবে নথিভুক্ত করা হয়েছে (demo - লোকাল সংরক্ষণ)।</div>
        </div>
      </div>

      <div class="receipt" id="receiptArea" aria-live="polite">
        <div class="field"><div class="label">Election</div><div class="value" id="r-election">—</div></div>
        <div class="field"><div class="label">Candidate</div><div class="value" id="r-candidate">—</div></div>
        <div class="field"><div class="label">Voter</div><div class="value" id="r-voter">Sadman Sakib</div></div>
        <div class="field"><div class="label">Voter ID</div><div class="value" id="r-voterid">0112330403</div></div>
        <div class="field"><div class="label">Time</div><div class="value" id="r-time">—</div></div>
        <div class="field"><div class="label">Receipt ID</div><div class="value" id="r-id">—</div></div>
      </div>

      <div class="meta" id="metaRow">
        <div class="small" id="receiptHint">এই রশিদটি সংরক্ষণ করুন — প্রয়োজনে প্রমাণ হিসেবে ব্যবহার করুন।</div>
        <div class="small" id="localNote">স্ট্যাটাস: লোকাল ডেমো (LocalStorage) — সার্ভার সংযুক্ত করা হয় নি।</div>
      </div>

      <div class="btn-row" style="margin-top:16px">
        <button class="btn primary" id="doneBtn">Done — Back to Dashboard</button>
        <button class="btn ghost" id="printBtn">Print / Save as PDF</button>
        <button class="btn alt" id="copyBtn">Copy Receipt</button>
      </div>

      <div class="note" id="formalNote">
        দ্রষ্টব্য: এই ডেমো-সিস্টেম ক্লায়েন্ট-সাইড (ব্রাউজারে) লোকালভাবে রেকর্ড রাখে। বাস্তব ব্যবস্থায় ভোট নিরীক্ষণ ও স্টোরেজ সার্ভারে সুরক্ষিতভাবে করা হবে এবং ফলাফল অফিসিয়ালি প্রকাশ করা হবে — অনুগ্রহ করে ধৈর্য্য ধরুন।
      </div>
    </div>
  </main>

<script>
(function(){
  // read params
  const params = new URLSearchParams(window.location.search);
  const election = params.get('election') || '—';
  const candidate = params.get('candidate') || '—';

  // fill UI
  document.getElementById('r-election').textContent = election;
  document.getElementById('r-candidate').textContent = candidate;

  const now = new Date();
  document.getElementById('r-time').textContent = now.toLocaleString('bn-BD') || now.toString();

  // generate receipt id (deterministic enough for demo)
  const rid = 'R' + Math.floor(100000 + Math.random()*900000);
  document.getElementById('r-id').textContent = rid;

  // helper to map name -> short key for localStorage
  function electionKeyFromName(name){
    if(!name) return '';
    const n = name.toLowerCase();
    if(n.includes('national')) return 'national';
    if(n.includes('city')) return 'city';
    if(n.includes('paurashava') || n.includes('pourashava')) return 'paurashava';
    if(n.includes('upazila')) return 'upazila';
    if(n.includes('zila')) return 'zila';
    if(n.includes('union')) return 'union';
    return name.replace(/\s+/g,'_').toLowerCase();
  }

  // store vote into localStorage
  function storeVote(){
    const key = electionKeyFromName(election);
    if(!key) return;
    try{
      localStorage.setItem('voted_'+key, 'true');
      localStorage.setItem('voted_'+key+'_candidate', candidate);
      localStorage.setItem('voted_'+key+'_time', now.toISOString());
      localStorage.setItem('voted_'+key+'_receipt', rid);
      // keep a general votes list (array of keys) for possible future use
      const all = JSON.parse(localStorage.getItem('voted_all') || '[]');
      if(!all.includes(key)) all.push(key);
      localStorage.setItem('voted_all', JSON.stringify(all));
    }catch(e){
      console.warn('LocalStorage write failed', e);
    }
  }

  // copy receipt text
  function buildReceiptText(){
    return [
      '*** Vote Receipt ***',
      'Election: ' + election,
      'Candidate: ' + candidate,
      'Voter: Sadman Sakib',
      'Voter ID: 0112330403',
      'Time: ' + new Date().toLocaleString(),
      'Receipt ID: ' + rid,
      'Note: Demo (local).'
    ].join('\\n');
  }

  // button handlers
  document.getElementById('doneBtn').addEventListener('click', function(){
    storeVote();
    // redirect to dashboard with voted flag so banner shows
    const key = electionKeyFromName(election);
    const url = 'voter_page.html' + (key ? '?voted=' + encodeURIComponent(key) : '');
    window.location.href = url;
  });

  document.getElementById('printBtn').addEventListener('click', function(){
    // nice print
    window.print();
  });

  document.getElementById('copyBtn').addEventListener('click', function(){
    const text = buildReceiptText();
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(text).then(()=> {
        alert('Receipt text copied to clipboard.');
      }).catch(()=> {
        fallbackCopy(text);
      });
    } else {
      fallbackCopy(text);
    }
  });

  function fallbackCopy(text){
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    try{
      document.execCommand('copy');
      alert('Receipt text copied to clipboard.');
    }catch(e){
      alert('Copy failed — please select and copy manually.');
    }
    document.body.removeChild(ta);
  }

  // if there are no query params, show a friendly message
  if(election === '—' && candidate === '—'){
    document.getElementById('receiptHint').textContent = 'কোনো নির্বাচনের ডেটা পাওয়া যায়নি।';
    // still allow user to go back
  }

  // accessibility: Esc -> go back
  document.addEventListener('keydown', function(e){
    if(e.key === 'Escape'){
      // store and go back
      storeVote();
      window.location.href = 'voter_page.html';
    }
  });

})();
</script>
</body>
</html>
