<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voter Dashboard — Bangladesh Election Commission</title>

  <style>
    /* base */
    :root{--green-600:#0b6a33; --green-400:#2fa14f;}
    body{margin:0;font-family:"Noto Sans Bengali","Noto Sans",Arial,sans-serif;background:#f6faf8;color:#0b3a2e}
    a{color:var(--green-600)}

    /* topbar */
    .topbar{background:#fff;padding:14px 22px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #e3eee7}
    .brand{font-weight:800;color:var(--green-600);font-size:20px}

    /* wrapper */
    .wrap{max-width:1100px;margin:24px auto;padding:20px}

    .welcome{font-size:24px;font-weight:800;color:var(--green-600);margin-bottom:14px}

    /* profile card */
    .profile-card{background:#fff;border-radius:16px;padding:28px;box-shadow:0 20px 50px rgba(6,60,30,0.10);display:flex;gap:26px;align-items:flex-start}
    .photo{width:160px;height:200px;border-radius:12px;object-fit:cover;border:2px solid #cfe8d6}
    .info{flex:1}
    .info h2{margin:0;font-size:22px;font-weight:800;color:var(--green-600)}
    .info table{margin-top:12px;width:100%;border-collapse:collapse}
    .info td{padding:8px 4px;font-size:16px;color:#345243}
    .label{font-weight:700;width:200px;color:#0b4f33}

    /* eligibility box */
    .elig-box{margin-top:18px;border-radius:12px;padding:16px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 14px 40px rgba(6,60,30,0.08);background:#fff;border:1px solid rgba(0,0,0,0.04)}
    .elig-left{display:flex;align-items:center;gap:14px}
    .elig-loader{width:32px;height:32px;border-radius:50%;border:4px solid rgba(11,106,51,0.20);border-top-color:var(--green-600);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .elig-tick{width:60px;height:60px;border-radius:50%;background:linear-gradient(180deg,var(--green-400),var(--green-600));color:#fff;font-size:32px;font-weight:900;display:flex;align-items:center;justify-content:center;opacity:0;transform:scale(.5);transition:.35s ease}
    .elig-tick.show{opacity:1;transform:scale(1)}
    .elig-msg{font-weight:800;color:var(--green-600);font-size:16px}
    .elig-note{font-size:13px;color:#61756a;margin-top:4px}
    .elig-red{color:#b12727;font-weight:800}

    /* donate card */
    .donate-wrap{display:flex;justify-content:center;margin:18px 0 6px;z-index:5}
    .donate-card{background:linear-gradient(180deg,#fff,#f7fffb);border:1px solid rgba(11,79,49,0.06);box-shadow:0 14px 40px rgba(6,60,30,0.06);padding:12px 18px;border-radius:12px;display:flex;gap:12px;align-items:center;max-width:760px;width:92%}
    .donate-card .left{font-weight:800;color:var(--green-600);font-size:15px}
    .donate-card .right{margin-left:auto;display:flex;gap:10px;align-items:center}
    .btn-donate{background:linear-gradient(180deg,var(--green-400),var(--green-600));color:#fff;padding:10px 14px;border-radius:10px;border:none;font-weight:800;cursor:pointer}
    .btn-ghost-small{background:transparent;border:1px solid rgba(11,79,49,0.08);padding:8px 10px;border-radius:10px;color:var(--green-600);cursor:pointer;font-weight:700;font-size:13px}

    /* donate modal */
    .dmodal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.36);display:none;align-items:center;justify-content:center;z-index:9999}
    .dmodal{width:920px;max-width:96%;background:#fff;border-radius:12px;padding:18px;box-shadow:0 30px 80px rgba(6,60,30,0.18);display:flex;gap:16px}
    .dmodal .left-col{flex:1;min-width:260px;border-right:1px solid rgba(6,60,30,0.04);padding-right:12px}
    .dmodal .right-col{flex:1;min-width:300px;padding-left:12px}
    .dmodal h3{margin:0 0 8px;color:var(--green-600)}
    .select, input[type="number"], input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6efe8;font-size:15px}
    .candidate-item{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;border:1px solid transparent;cursor:pointer}
    .candidate-item img{width:56px;height:56px;border-radius:8px;object-fit:cover;border:1px solid #e9f3ee}
    .candidate-item.selected{background:linear-gradient(180deg,#f2fff6,#ffffff);border-color:rgba(11,79,49,0.08);box-shadow:0 8px 28px rgba(11,79,49,0.06)}
    .don-hist{max-height:220px;overflow:auto;border-top:1px dashed #e6efe8;padding-top:10px;margin-top:10px}
    .small-muted{font-size:13px;color:#5a6f62}

    /* election box */
    .election-box{background:#fff;padding:22px;margin-top:18px;border-radius:16px;box-shadow:0 18px 40px rgba(6,60,30,0.08)}
    .election-title{color:var(--green-600);font-size:20px;font-weight:800;margin-top:0;margin-bottom:12px}
    .election-dropdown{width:100%;padding:14px;font-size:16px;border-radius:10px;border:1px solid #cfe8d6;outline:none}
    .election-dropdown:focus{border-color:var(--green-600);box-shadow:0 10px 25px rgba(11,79,49,0.12)}

    .footer{text-align:center;padding:18px;color:#4b6758;margin-top:30px;font-size:14px}

    @media(max-width:880px){.dmodal{flex-direction:column}.dmodal .left-col{border-right:none;padding-right:0}.dmodal .right-col{padding-left:0}}
    @media(max-width:700px){.profile-card{flex-direction:column;align-items:center;text-align:center}.label{width:140px}.elig-box{flex-direction:column;align-items:flex-start}}
  </style>
</head>
<body>

  <header class="topbar">
    <div class="brand">বাংলাদেশ নির্বাচন কমিশন</div>
    <div><a id="logoutLink" href="index.html" style="color:var(--green-600);font-weight:700;text-decoration:none">Logout</a></div>
  </header>

  <main class="wrap">
    <div class="welcome">স্বাগতম, <span style="color:var(--green-400)">Sadman Sakib</span>!</div>

    <!-- PROFILE -->
    <section class="profile-card" aria-label="Voter profile">
      <img src="images/123.jpg" alt="Profile Photo" class="photo" onerror="this.src='images/photo2.jpeg'">

      <div class="info">
        <h2>Voter Profile</h2>
        <table>
          <tr><td class="label">নাম</td><td id="pfName">Sadman Sakib</td></tr>
          <tr><td class="label">Voter ID</td><td id="pfVoter">0112330403</td></tr>
          <tr><td class="label">মোবাইল নম্বর</td><td id="pfMobile">01316448433</td></tr>
          <tr><td class="label">ঠিকানা / এলাকা</td><td id="pfArea">Rajshahi, Bangladesh</td></tr>
          <tr><td class="label">জন্মতারিখ</td><td id="pfDob">20-10-2003</td></tr>
          <tr><td class="label">লিঙ্গ</td><td id="pfGender">Male</td></tr>
        </table>
      </div>
      <div style="
  border:2px solid #0b6a33;
  padding:16px;
  border-radius:12px;
  background:#ffffff;
  box-shadow:0 10px 32px rgba(6,60,30,0.10);
  width:100%;
  max-width:320px;
  margin-top:20px;
">
  <div style="
    font-size:18px;
    font-weight:800;
    color:#0b6a33;
    text-align:center;
    margin-bottom:10px;
  ">
    See Live Vote Cast
  </div>

  <button onclick="window.location.href='live_vote.html'"
  style="
    width:100%;
    padding:12px 0;
    background:linear-gradient(180deg,#2fa14f,#0b6a33);
    color:#fff;
    border:none;
    border-radius:10px;
    font-size:16px;
    font-weight:800;
    cursor:pointer;
    box-shadow:0 12px 30px rgba(11,79,49,0.20);
  ">
    Click Here
  </button>
</div>

    </section>

    <!-- ELIGIBILITY BOX (loader -> tick) -->
    <div id="eligBox" class="elig-box" aria-live="polite">
      <div class="elig-left">
        <div id="eligLoader" class="elig-loader" aria-hidden="true"></div>
        <div>
          <div id="eligMsg" class="elig-msg">Calculating eligibility…</div>
          <div class="elig-note">Minimum age to vote: 18 years</div>
        </div>
      </div>
      <div>
        <div id="eligTick" class="elig-tick" aria-hidden="true">✓</div>
      </div>
    </div>

    <!-- DONATE CARD -->
    <div class="donate-wrap" aria-hidden="false">
      <div class="donate-card" role="region" aria-label="Donate for campaign">
        <div class="left">
          Donate for Election Campaign — Candidate Support (BDT)
          <div class="small-muted" style="font-weight:600;font-size:13px">আপনি পছন্দমত ক্যান্ডিডেটকে অনুদান দিতে পারবেন।</div>
        </div>

        <div class="right">
          <button class="btn-ghost-small" id="viewCandidatesBtn">View Candidates</button>
          <button class="btn-donate" id="openDonateModal">Donate</button>
        </div>
      </div>
    </div>

    <!-- DONATE MODAL -->
    <div id="dmodalOverlay" class="dmodal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="dmodal" role="document" aria-label="Donate modal">
        <div class="left-col">
          <h3>Choose Election &amp; Candidate</h3>
          <label class="small-muted">Select Election</label>
          <select id="donationElection" class="select" aria-label="Select election">
            <option value="national">National Parliament Election</option>
            <option value="city">City Corporation Election</option>
            <option value="paurashava">Paurashava Election</option>
            <option value="upazila">Upazila Election</option>
            <option value="zila">Zila Parishad Election</option>
            <option value="union">Union Parishad Election</option>
          </select>

          <div style="margin-top:12px">
            <label class="small-muted">Candidates</label>
            <div id="candidatesList" style="display:flex;flex-direction:column;gap:8px;margin-top:8px" aria-live="polite"></div>
          </div>

          <div class="don-hist" id="donationHistory">
            <strong>Donation History</strong>
            <div id="donHistList" style="margin-top:8px;font-size:14px;color:#3b5d49"></div>
          </div>
        </div>

        <div class="right-col">
          <h3>Donate</h3>
          <div class="donate-meta">Selected: <span id="selCandidate">—</span></div>

          <label class="small-muted">Amount (BDT)</label>
          <input id="donAmount" type="number" min="50" placeholder="Enter amount in BDT" />

          <label style="margin-top:8px" class="small-muted">Donor Name (optional)</label>
          <input id="donorName" type="text" placeholder="Your name (প্রয়োজনে)" />

          <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
            <button class="btn-donate" id="sendDonateBtn">Send Donation</button>
            <button class="btn-ghost-small" id="closeDonate">Close</button>
          </div>

          <div id="donStatus" style="margin-top:12px;font-weight:700;color:#1f7b45"></div>

          <div style="margin-top:18px;color:#50645a;font-size:13px">
            Note: This is a demo donation UI — payment is simulated. For real payments integrate a gateway (bkash, nagad, card).
          </div>
        </div>
      </div>
    </div>

    <!-- ELECTION SELECTION -->
    <div class="election-box">
      <h2 class="election-title">Vote Option নির্বাচন করুন</h2>
      <select id="electionSelect" class="election-dropdown" disabled>
        <option value="" selected disabled>-- নির্বাচন নির্বাচন করুন --</option>
        <option value="national">National Parliament Election</option>
        <option value="city">City Corporation Election</option>
        <option value="paurashava">Paurashava Election</option>
        <option value="upazila">Upazila Election</option>
        <option value="zila">Zila Parishad Election</option>
        <option value="union">Union Parishad Election</option>
      </select>
    </div>

  </main>

  <footer class="footer">© Bangladesh Election Commission</footer>

  <!-- ===================== SCRIPTS ===================== -->
  <script>
  /* ---------------------------
     Candidates dataset (for donate modal)
     --------------------------- */
  const CANDIDATES = {
    national: [
      { id:'nat-1', name:'Md Nehal', party:'Independent', photo:'images/c1.jpg' },
      { id:'nat-2', name:'Md Reaz', party:'Party X', photo:'images/c2.jpg' }
    ],
    city: [
      { id:'city-1', name:'Mr. M Hasan', party:'Party Y', photo:'images/c3.jpg' },
      { id:'city-2', name:'Ms. R Akter', party:'Party Z', photo:'images/c4.jpg' }
    ],
    paurashava: [
      { id:'p-1', name:'Taufiq Mahmud', party:'Independent', photo:'images/c5.jpg' },
      { id:'p-2', name:'Sadman Jahin', party:'Progressive Party', photo:'images/c6.jpg' }
    ],
    upazila:[
      { id:'u-1', name:'Mr. N Uddin', party:'Party B', photo:'images/c7.jpg' },
      { id:'u-2', name:'Ms. L Khan', party:'Party C', photo:'images/c8.jpg' }
    ],
    zila:[
      { id:'z-1', name:'Mr. D Chowdhury', party:'Party D', photo:'images/c9.jpg' },
      { id:'z-2', name:'Ms. P Sultana', party:'Party E', photo:'images/c10.jpg' }
    ],
    union:[
      { id:'un-1', name:'Mr. S Molla', party:'Independent', photo:'images/c11.jpg' },
      { id:'un-2', name:'Ms. H Jahan', party:'Party F', photo:'images/c12.jpg' }
    ]
  };

  /* render candidates inside donate modal */
  function renderCandidates(election){
    const wrap = document.getElementById('candidatesList');
    wrap.innerHTML = '';
    const list = CANDIDATES[election] || [];
    list.forEach(c=>{
      const node = document.createElement('div');
      node.className = 'candidate-item';
      node.tabIndex = 0;
      node.dataset.cid = c.id;
      node.innerHTML = `<img src="${c.photo}" alt="${c.name}" onerror="this.style.opacity=.5"><div style="flex:1"><strong style="display:block">${c.name}</strong><div class="small-muted">${c.party}</div></div>`;
      node.addEventListener('click', ()=> selectCandidate(node, c));
      node.addEventListener('keydown', (ev)=> { if(ev.key==='Enter') selectCandidate(node,c); });
      wrap.appendChild(node);
    });
    if(list.length){
      setTimeout(()=> { const first = wrap.querySelector('.candidate-item'); if(first) first.click(); }, 50);
    } else { document.getElementById('selCandidate').textContent = '—'; }
  }

  /* candidate select for donate */
  let currentSelected = null;
  function selectCandidate(node,candidate){
    document.querySelectorAll('.candidate-item').forEach(n=>n.classList.remove('selected'));
    node.classList.add('selected');
    currentSelected = candidate;
    document.getElementById('selCandidate').textContent = candidate.name + ' · ' + candidate.party;
  }

  /* donate modal controls */
  const dmodal = document.getElementById('dmodalOverlay');
  document.getElementById('openDonateModal').addEventListener('click', ()=> {
    dmodal.style.display = 'flex'; dmodal.setAttribute('aria-hidden','false');
    const el = document.getElementById('donationElection').value;
    renderCandidates(el);
    loadDonationHistory();
  });
  document.getElementById('closeDonate').addEventListener('click', closeDonate);
  document.getElementById('viewCandidatesBtn').addEventListener('click', ()=> document.getElementById('openDonateModal').click());
  document.getElementById('donationElection').addEventListener('change', (e)=> renderCandidates(e.target.value));
  function closeDonate(){ dmodal.style.display='none'; dmodal.setAttribute('aria-hidden','true'); currentSelected=null; document.getElementById('donAmount').value=''; document.getElementById('donorName').value=''; document.getElementById('donStatus').textContent=''; }

  /* donation send (simulated) */
  document.getElementById('sendDonateBtn').addEventListener('click', ()=> {
    const amountEl = document.getElementById('donAmount');
    const amt = parseFloat(amountEl.value);
    const donor = document.getElementById('donorName').value.trim() || 'Anonymous';
    const statusEl = document.getElementById('donStatus');

    if(!currentSelected){ statusEl.style.color='#b12727'; statusEl.textContent='প্রথমে একটি ক্যান্ডিডেট সিলেক্ট করুন।'; return; }
    if(!amt || amt < 50){ statusEl.style.color='#b12727'; statusEl.textContent='ন্যূনতম ৫০ BDT পাঠাতে হবে।'; return; }

    const key = 'evotee_donations';
    let ledger = JSON.parse(localStorage.getItem(key) || '[]');
    const entry = { id:'don-'+Date.now(), candidate_id: currentSelected.id, candidate_name: currentSelected.name, election: document.getElementById('donationElection').value, amount: amt, donor: donor, ts: new Date().toISOString() };
    ledger.unshift(entry);
    localStorage.setItem(key, JSON.stringify(ledger));

    statusEl.style.color='#0b6a33'; statusEl.textContent='Donation sent (simulated). ধন্যবাদ!';
    loadDonationHistory();
    amountEl.value='';
  });

  function loadDonationHistory(){
    const key = 'evotee_donations';
    const hist = JSON.parse(localStorage.getItem(key) || '[]');
    const wrap = document.getElementById('donHistList');
    if(!hist.length){ wrap.innerHTML = '<div class="small-muted">কোনো অনুদান দেখা যায়নি।</div>'; return; }
    wrap.innerHTML = '';
    hist.slice(0,10).forEach(h=>{
      const row = document.createElement('div');
      row.style.padding='8px 0'; row.style.borderBottom='1px dashed #eef6ee';
      row.innerHTML = `<div style="font-weight:800">${h.candidate_name} <span style="font-weight:700;color:#0b6a33">+${h.amount} BDT</span></div><div class="small-muted">${new Date(h.ts).toLocaleString()}</div>`;
      wrap.appendChild(row);
    });
  }

  /* -------------------------
     Eligibility logic (uses pfDob from profile table)
     ------------------------- */
  function parseDobStr(dobStr){
    if(!dobStr) return null;
    const parts = dobStr.split('-').map(s=>parseInt(s,10));
    if(parts.length!==3 || parts.some(isNaN)) return null;
    return new Date(parts[2], parts[1]-1, parts[0]);
  }
  function calcAgeYears(dob){
    if(!dob) return null;
    const now = new Date();
    let age = now.getFullYear() - dob.getFullYear();
    const md = now.getMonth() - dob.getMonth();
    if(md < 0 || (md === 0 && now.getDate() < dob.getDate())) age--;
    return age;
  }

  function lockVoting(){ document.getElementById('electionSelect').disabled = true; }
  function unlockVoting(){ document.getElementById('electionSelect').disabled = false; }

  function computeEligibilityWithDelay(){
    const loader = document.getElementById('eligLoader');
    const msg = document.getElementById('eligMsg');
    const tick = document.getElementById('eligTick');

    // start with loader visible and drop down locked
    loader.style.display = 'block';
    tick.classList.remove('show');
    lockVoting();
    msg.textContent = 'Calculating eligibility…';

    // simulate 1.2-1.8s loading for nicer UX
    const delay = 1200 + Math.floor(Math.random()*600);
    setTimeout(()=> {
      const dobStr = document.getElementById('pfDob') ? document.getElementById('pfDob').textContent.trim() : null;
      const dob = parseDobStr(dobStr);
      const age = calcAgeYears(dob);

      loader.style.display = 'none';
      if(age === null){
        msg.innerHTML = '<span class="elig-red">জন্মতারিখ সঠিক নয় — যাচাই করুন</span>';
        lockVoting();
        return;
      }

      if(age >= 18){
        msg.innerHTML = `You are eligible — আপনি ${age} বছর বয়সী (18+)`;
        tick.classList.add('show');
        unlockVoting();
      } else {
        msg.innerHTML = `<span class="elig-red">Not eligible — আপনি মাত্র ${age} বছর; 18+ প্রয়োজন</span>`;
        tick.classList.remove('show');
        lockVoting();
      }
    }, delay);
  }

  /* prevent underage users from navigating to election pages */
  document.getElementById('electionSelect').addEventListener('change', function(){
    const dobStr = document.getElementById('pfDob') ? document.getElementById('pfDob').textContent.trim() : null;
    const dob = parseDobStr(dobStr);
    const age = calcAgeYears(dob);
    if(age === null){ alert('জন্মতারিখ সঠিক নয়।'); this.value=''; return; }
    if(age < 18){ alert('দুঃখিত — 18 বছর পূরণ না হলে ভোট দেওয়া যাবে না।'); this.value=''; return; }
    // allowed -> redirect to respective voting page
    const type = this.value;
    if(type === "national") window.location.href = "national_parliament_voting.html";
    else if(type === "city") window.location.href = "city_corporation_voting.html";
    else if(type === "paurashava") window.location.href = "paurashava_voting.html";
    else if(type === "upazila") window.location.href = "upazila_voting.html";
    else if(type === "zila") window.location.href = "zila_parishad_voting.html";
    else if(type === "union") window.location.href = "union_parishad_voting.html";
  });

  /* init on load */
  document.addEventListener('DOMContentLoaded', function(){
    // populate default donate candidates and donation history
    renderCandidates(document.getElementById('donationElection').value);
    loadDonationHistory();
    // run eligibility check (loader + tick)
    computeEligibilityWithDelay();
  });

  // close donate modal with Esc
  document.addEventListener('keydown', (e)=> {
    if(e.key === 'Escape' && dmodal.style.display === 'flex') closeDonate();
  });

  </script>
</body>
</html>
